// ================================
//  GENERATORS / DATASOURCE
// ================================
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ================================
//  MODELO: Ticket
// ================================
model Ticket {
  id                     String    @id @default(cuid())
  ticket_key             String    @unique
  message_id_original    String    @unique

  subject_original       String
  from_name              String?
  from_email             String
  origen_real            String
  sector_principal       String
  sectores_involucrados  String[]  // ventas, administracion, tesoreria

  estado                 String    @default("pendiente") // pendiente / respondido / cerrado
  is_answered_global     Boolean   @default(false)

  created_at             DateTime  @default(now())
  updated_at             DateTime  @updatedAt

  messages               TicketMessage[]
}

// ================================
//  MODELO: TicketMessage
// ================================
model TicketMessage {
  id              String    @id @default(cuid())

  ticket_id       String
  ticket          Ticket    @relation(fields: [ticket_id], references: [id], onDelete: Cascade)

  message_id      String    @unique                    // Único por mail real
  from_name       String?
  from_email      String?
  to_email        String?
  subject         String?
  html            String?
  text            String?
  raw_headers     Json?

  received_at     DateTime
  created_at      DateTime  @default(now())

  // Para métricas futuras
  tipo            String?   // entrada_cliente | reply_interno | reply_cliente | system | etc
  origen          String?   // ventas/admin/teso/buffer/sendgrid
}

// ================================
//  ÍNDICES IMPORTANTES
// ================================
@@index([ticket_key])
@@index([message_id_original])
@@index([from_email])
@@index([sector_principal])
