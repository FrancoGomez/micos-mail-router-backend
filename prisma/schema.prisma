generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum OrigenReal {
  hotmail
  chubut
  lapampa
  mza
  audiologia
  tesoreria
  directo
}

enum SectorPrincipal {
  ventas
  admin
  teso
}

enum TicketEstado {
  pendiente
  respondido
}

enum MessageDirection {
  in
  out
  internal
}

model Ticket {
  id                    String   @id @default(uuid())
 message_id_original   String   @unique

  subject               String?
  from_name             String?
  from_email            String?

  origen_real           OrigenReal
  sector_principal      SectorPrincipal

  sectores_involucrados Json      @default("[]")

  estado                TicketEstado @default(pendiente)
  is_answered_global    Boolean      @default(false)

  created_at            DateTime @default(now())
  updated_at            DateTime @updatedAt

  messages              TicketMessage[]
}

model TicketMessage {
  id                String   @id @default(uuid())
  ticket_id         String
  ticket            Ticket   @relation(fields: [ticket_id], references: [id], onDelete: Cascade)

  direction         MessageDirection

  raw_message_id    String?
  references_in     String?
  body_html         String?
  body_text         String?
  attachments       Json?
  interno_responde  String?

  created_at        DateTime @default(now())
}

model SyncLog {
  id             String   @id @default(uuid())
  raw_message_id String
  source         String
  processed_at   DateTime @default(now())
}
